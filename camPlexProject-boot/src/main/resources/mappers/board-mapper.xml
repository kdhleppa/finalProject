<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!-- namespace를 Mapper 인터페이스로 지정 -->
<mapper namespace="com.camplex.project.board.mappers.BoardMapper">
	
	<!-- Board DTO에 대한 resultMap -->
	<resultMap type="Board" id="board_rm">
	
		<id property="boardNo" column="BOARD_NO"/>
		
		<result property="boardTitle" column="BOARD_TITLE"/>
		<result property="boardContent" column="BOARD_CONTENT"/>
		<result property="boardReadCount" column="B_READ_COUNT"/>
		<result property="boardType" column="BOARD_TYPE"/>
		<result property="boardCreateDate" column="B_CREATE_DATE"/>
		<result property="boardDetailType" column="B_DETAIL_TYPE"/>
		
		<result property="boardTypeName" column="BOARD_TYPE_NAME"/>
		
		<result property="memberNickname" column="MEMBER_NICKNAME"/>
		<result property="memberNo" column="MEMBER_NO"/>
		
	</resultMap>
	
		<!-- 게시판 종류 목록 조회 -->
		<select id="selectBoardTypeList" resultType="map">
			SELECT * FROM "BOARD_TYPE_FL" ORDER BY 1
		</select>
		
		<!-- 특정 게시판의 삭제되지 않은 게시글 수 조회 -->
	  	<select id="getListCount" resultType="_int">
	  		SELECT COUNT(*) FROM BOARD
			WHERE BOARD_DEL_FL = 'N'
			AND BOARD_TYPE = #{boardType}
	  	</select>
	  	
	  	<!-- CDATA 태그 : 해당 태그 내부에 작성된 것은 모두 문자로 취급 -->
	  	<select id="selectBoardList" resultMap="board_rm">
	  		SELECT BOARD_NO, BOARD_TITLE, MEMBER_NICKNAME, B_READ_COUNT, B_CREATE_DATE
			FROM "BOARD"
			JOIN "MEMBER" USING(MEMBER_NO)
			WHERE BOARD_DEL_FL = 'N'
			AND BOARD_TYPE = #{boardType}
			ORDER BY BOARD_NO DESC
	  	</select>
	  	
	  	<!-- 게시글 목록 조회(검색) -->
	  	<select id="selectSearchBoardList" resultMap="board_rm">
	  		SELECT BOARD_NO, BOARD_TITLE, MEMBER_NICKNAME, B_READ_COUNT, B_CREATE_DATE
			FROM "BOARD"
			JOIN "MEMBER" USING(MEMBER_NO)
			WHERE BOARD_DEL_FL = 'N'
			AND BOARD_TYPE = #{boardType}
			
			<choose>
				<when test='key == "t"'>
					<!-- 제목 -->
					AND BOARD_TITLE LIKE '%${query}%'
				</when>
				
				<when test='key == "c"'>
					<!-- 내용 -->
					AND BOARD_CONTENT LIKE '%${query}%'
				</when>
				
				<when test='key == "tc"'>
					<!-- 제목 + 내용 -->
					AND (BOARD_TITLE LIKE '%${query}%' OR BOARD_CONTENT LIKE '%${query}%')
				</when>
				
				<when test='key == "w"'>
					<!-- 작성자(닉네임) -->
					AND MEMBER_NICKNAME LIKE '%${query}%'
				</when>
				
			</choose>
			
			
			ORDER BY BOARD_NO DESC
	  	</select>
	  	
	  	
	  	<!-- 특정 게시판의 삭제되지 않고, 검색 조건이 일치하는 게시글 수 조회 -->
	  	<select id="getSearchListCount" resultType="_int">
	  		SELECT COUNT(*) FROM BOARD
	  		
	  		<!-- 작성자 검색 -->
	  		<if test='key == "w"'>
	  			JOIN "MEMBER" USING(MEMBER_NO)
	  		</if>
	  		
			WHERE BOARD_DEL_FL = 'N'
			AND BOARD_TYPE = #{boardType}
			
			<choose>
				<when test='key == "t"'>
					<!-- 제목 -->
					AND BOARD_TITLE LIKE '%${query}%'
				</when>
				
				<when test='key == "c"'>
					<!-- 내용 -->
					AND BOARD_CONTENT LIKE '%${query}%'
				</when>
				
				<when test='key == "tc"'>
					<!-- 제목 + 내용 -->
					AND (BOARD_TITLE LIKE '%${query}%' OR BOARD_CONTENT LIKE '%${query}%')
				</when>
				
				<when test='key == "w"'>
					<!-- 작성자(닉네임) -->
					AND MEMBER_NICKNAME LIKE '%${query}%'
				</when>
				
			</choose>
			
	  	</select>
	  	
		
	
</mapper>